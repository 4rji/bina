#!/usr/bin/env python3
import sys, hashlib, requests

USER_AGENT = "pwned-check/1.0"

def sha1(s):
    return hashlib.sha1(s.encode("utf-8")).hexdigest().upper()

def query(prefix):
    url = f"https://api.pwnedpasswords.com/range/{prefix}"
    headers = {"User-Agent": USER_AGENT}
    r = requests.get(url, headers=headers, timeout=10)
    r.raise_for_status()
    return r.text.splitlines()

def check_hash(sha1hex):
    prefix, suffix = sha1hex[:5], sha1hex[5:]
    for line in query(prefix):
        h, c = line.split(":")
        if h.strip().upper() == suffix:
            return int(c.strip())
    return 0

if len(sys.argv) < 2:
    print("Usage: ./check_pwned.py <password-or-sha1>")
    sys.exit(1)

arg = sys.argv[1].strip()
if len(arg) == 40 and all(c in "0123456789abcdefABCDEF" for c in arg):
    sha1hex = arg.upper()
else:
    sha1hex = sha1(arg)

count = check_hash(sha1hex)
print(f"Found {count} times" if count else "Not found in breaches")
