#!/usr/bin/env bash
set -euo pipefail

# Function to display messages
echo_msg() {
    echo "=============================================="
    echo "$1"
    echo "=============================================="
}

OPTIONS=(
  "LocIp — Locate IPs from the CLI"
  "trafico — Configurable traffic simulator for a specific target"
  "traficoS — HTTPS simulator with predefined domains"
  "sshc — Run same command across every host (module mode enabled)"
  "Quit"
)

# full install commands (kept separate so we don't print paths)
commands=(
  "go install github.com/4rji/LocIp@latest"
  "go install github.com/4rji/binarios-go/trafico/cmd/trafico@latest"
  "go install github.com/4rji/binarios-go/trafico/cmd/traficoS@latest"
  "GO111MODULE=on go install github.com/4rji/binarios-go/sshc@latest"
)

# short binary names to display only
bins=(
  "LocIp"
  "trafico"
  "traficoS"
  "sshc"
)

echo ""
echo "_________________________________________________________"
echo ""

echo_msg "$(printf '\033[1;35m%s\033[0m' 'Available installers')"

echo ""
for i in "${!OPTIONS[@]}"; do
  num=$((i+1))
  printf "\033[1;37m  %2d)\033[0m  \033[36m%s\033[0m\n\n" "$num" "${OPTIONS[i]}"
done

echo ""
echo "_________________________________________________________"
echo ""

read -r -p "$(printf '\033[33mChoose installer number (1-%d) and press Enter:\033[0m ' "${#OPTIONS[@]}")" choice
echo ""
echo "_________________________________________________________"
echo ""

if ! [[ "$choice" =~ ^[0-9]+$ ]]; then
  printf "\033[31mInvalid selection.\033[0m\n\n"; exit 1
fi

if (( choice < 1 || choice > ${#OPTIONS[@]} )); then
  printf "\033[31mSelection out of range.\033[0m\n\n"; exit 1
fi

if (( choice == ${#OPTIONS[@]} )); then
  echo_msg "$(printf '\033[1;34m%s\033[0m' 'Quit selected')"
  echo ""
  exit 0
fi

idx=$((choice-1))
cmd="${commands[idx]}"
bin="${bins[idx]}"

echo_msg "$(printf '\033[1;35m%s\033[0m' 'Description')"

case $idx in
  0) echo -e "  \033[36mLocate IPs from the CLI.\033[0m" ;;
  1) echo -e "  \033[36mConfigurable traffic simulator for a specific target.\033[0m" ;;
  2) echo -e "  \033[36mHTTPS simulator with predefined domains.\033[0m" ;;
  3) echo -e "  \033[36mHelper to run the same command across every host (module mode enabled).\033[0m" ;;
esac

echo ""
echo "_________________________________________________________"
echo ""

echo_msg "$(printf '\033[1;35m%s\033[0m' 'Running')"
# show only the binary name (no full go path)
printf "  \033[32mInstalling: %s\033[0m\n\n" "$bin"

# execute the real install command
eval "$cmd"

echo ""
echo "_________________________________________________________"
echo ""

echo_msg "$(printf '\033[1;35m%s\033[0m' 'Done')"
echo ""
