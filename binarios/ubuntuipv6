#!/usr/bin/env bash
set -euo pipefail

# Auto-sudo
if [[ $EUID -ne 0 ]]; then
  exec sudo bash "$0" "$@"
fi

CONF="/etc/sysctl.d/99-disable-ipv6.conf"

echo "[*] Disabling IPv6 system-wide..."

cat > "$CONF" <<EOF
net.ipv6.conf.all.disable_ipv6 = 1
net.ipv6.conf.default.disable_ipv6 = 1
net.ipv6.conf.lo.disable_ipv6 = 1
EOF

sysctl --system >/dev/null

echo "[+] IPv6 disabled"
echo "[*] Verifying..."
sysctl net.ipv6.conf.all.disable_ipv6
