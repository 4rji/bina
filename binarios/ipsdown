#!/usr/bin/env bash
set -e

OUT="${1:-./badips_ips}"
mkdir -p "$OUT"
cd "$OUT"

URLS=(
  "https://www.spamhaus.org/drop/drop.txt"
  "https://www.spamhaus.org/drop/edrop.txt"
  "https://www.spamhaus.org/drop/dropv6.txt"
  "https://lists.blocklist.de/lists/all.txt"
  "https://rules.emergingthreats.net/blockrules/compromised-ips.txt"
  "https://feodotracker.abuse.ch/downloads/ipblocklist.txt"
  "https://feodotracker.abuse.ch/downloads/ipblocklist_aggressive.txt"
)

# descarga todas y mezcla en un solo archivo limpio
for u in "${URLS[@]}"; do curl -fsSL "$u"; done \
  | grep -Eo '([0-9]{1,3}\.){3}[0-9]{1,3}(/[0-9]{1,2})?|([0-9a-fA-F]{0,4}:){1,7}[0-9a-fA-F]{0,4}(/[0-9]{1,3})?' \
  | sort -u > ips_list.txt

echo "Archivo final: $OUT/ips_list.txt"
