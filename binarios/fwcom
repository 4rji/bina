#!/usr/bin/env bash

# Function to show menu
show_menu() {
    echo ""
    echo -e "\033[1;34m===========================================================\033[0m"
    echo -e "\033[1;34m   Select an action:\033[0m"
    echo -e "\033[1;34m===========================================================\033[0m"
    echo ""
    echo -e "\033[1;32m1. View active zones\033[0m"
    echo -e "\033[1;32m2. View zone configuration\033[0m"
    echo -e "\033[1;32m3. View allowed services\033[0m"
    echo -e "\033[1;32m4. View allowed ports\033[0m"
    echo -e "\033[1;33m5. Block a port\033[0m"
    echo -e "\033[1;33m6. Allow a port (temporary)\033[0m"
    echo -e "\033[1;33m7. Allow a port (permanent)\033[0m"
    echo -e "\033[1;31m8. Deactivate the firewall\033[0m"
    echo -e "\033[1;31m9. Activate the firewall\033[0m"
    echo -e "\033[1;31m10. Reload firewall configuration\033[0m"
    echo -e "\033[1;36m11. Exit\033[0m"
    echo ""
}

# Function to display important messages
echo_msg() {
    echo -e "\033[1;35m==============================================\033[0m"
    echo -e "\033[1;35m$1\033[0m"
    echo -e "\033[1;37m$2\033[0m" # Command executed in white
    echo -e "\033[1;35m==============================================\033[0m"
    echo ""
}

while true; do
    show_menu
    read -rp "Enter your choice: " choice
    echo ""

    case $choice in
        1)
            cmd="firewall-cmd --get-active-zones"
            echo_msg "Viewing active zones..." "$cmd"
            sudo $cmd
            ;;
        2)
            read -rp "Enter the zone name: " zone
            cmd="firewall-cmd --zone=$zone --list-all"
            echo_msg "Viewing configuration for zone $zone..." "$cmd"
            sudo $cmd
            ;;
        3)
            cmd="firewall-cmd --list-services"
            echo_msg "Viewing allowed services..." "$cmd"
            sudo $cmd
            ;;
        4)
            cmd="firewall-cmd --list-ports"
            echo_msg "Viewing allowed ports..." "$cmd"
            sudo $cmd
            ;;
        5)
            read -rp "Enter the port and protocol to block (e.g., 80/tcp): " port
            read -rp "Enter the zone name: " zone
            cmd="firewall-cmd --zone=$zone --remove-port=$port --permanent && firewall-cmd --reload"
            echo_msg "Blocking port $port in zone $zone..." "$cmd"
            sudo firewall-cmd --zone="$zone" --remove-port="$port" --permanent
            sudo firewall-cmd --reload
            ;;
        6)
            read -rp "Enter the port and protocol to allow (e.g., 80/tcp): " port
            read -rp "Enter the zone name: " zone
            cmd="firewall-cmd --zone=$zone --add-port=$port"
            echo_msg "Allowing port $port in zone $zone temporarily..." "$cmd"
            sudo $cmd
            ;;
        7)
            read -rp "Enter the port and protocol to allow (e.g., 80/tcp): " port
            read -rp "Enter the zone name: " zone
            cmd="firewall-cmd --zone=$zone --add-port=$port --permanent && firewall-cmd --reload"
            echo_msg "Allowing port $port in zone $zone permanently..." "$cmd"
            sudo firewall-cmd --zone="$zone" --add-port="$port" --permanent
            sudo firewall-cmd --reload
            ;;
        8)
            cmd="systemctl stop firewalld"
            echo_msg "Deactivating the firewall..." "$cmd"
            sudo $cmd
            ;;
        9)
            cmd="systemctl start firewalld"
            echo_msg "Activating the firewall..." "$cmd"
            sudo $cmd
            ;;
        10)
            cmd="firewall-cmd --reload"
            echo_msg "Reloading firewall configuration..." "$cmd"
            sudo $cmd
            ;;
        11)
            echo_msg "Exiting the script. Goodbye!" ""
            exit 0
            ;;
        *)
            echo -e "\033[1;31mInvalid choice. Please select a valid option.\033[0m"
            ;;
    esac
    echo ""
done
