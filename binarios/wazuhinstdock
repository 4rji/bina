#!/usr/bin/env bash
set -euo pipefail

REPO_URL="https://github.com/wazuh/wazuh-docker.git"
BRANCH="v4.14.2"
DIR="wazuh-docker"

echo "[*] Cloning official Wazuh repo ($BRANCH)..."
if [[ -d "$DIR" ]]; then
  echo "[!] '$DIR' already exists. Remove it first."
  exit 1
fi

git clone --depth 1 --branch "$BRANCH" "$REPO_URL" "$DIR"

cd "$DIR/single-node"

echo "[*] Generating indexer certificates..."
docker compose -f generate-indexer-certs.yml run --rm generator

echo "[*] Starting Wazuh stack..."
docker compose up -d

echo ""
echo "=============================================="
echo " This is the default username and password to"
echo " access the Wazuh dashboard:"
echo ""
echo "   Username: admin"
echo "   Password: SecretPassword"
echo "=============================================="
echo ""