#!/usr/bin/env bash


#!/usr/bin/env bash

usage() {
  echo "Usage: $0 [-w | -s | -e]"
  exit 1
}

[[ $# -eq 0 ]] && usage

while getopts "wse" opt; do
  case "$opt" in
    w)
      echo "[WEBMAIL]"
      command -v httpd >/dev/null && httpd -v
      command -v php >/dev/null && php -v | head -n1
      command -v postfix >/dev/null && postconf -d | grep mail_version
      command -v dovecot >/dev/null && dovecot --version
      ;;
    s)
      echo "[SPLUNK]"
      if [[ -x /opt/splunk/bin/splunk ]]; then
        /opt/splunk/bin/splunk version
      else
        echo "Splunk not found"
      fi
      ;;
    e)
      echo "[ECOM]"
      command -v httpd >/dev/null && httpd -v
      command -v mysql >/dev/null && mysql --version
      ;;
    *)
      usage
      ;;
  esac
done



# ---- Colors ----
BOLD="\e[1m"
BLUE="\e[34m"
RESET="\e[0m"

# ---- Hostname ----
HOSTNAME=$(hostname)

# ---- Primary interface (default route) ----
IFACE=$(ip route show default 2>/dev/null | awk '{print $5}' | head -n1)

# ---- IP Address ----
IP_ADDRESS=$(ip -o -4 addr show "$IFACE" 2>/dev/null | awk '{print $4}' | cut -d/ -f1)

# ---- MAC Address ----
MAC_ADDRESS=$(cat /sys/class/net/"$IFACE"/address 2>/dev/null)

# ---- OS Info ----
if [ -f /etc/os-release ]; then
  . /etc/os-release
  OS_NAME="$NAME"
  OS_VERSION="$VERSION"
else
  OS_NAME=$(uname -s)
  OS_VERSION=$(uname -r)
fi

# ---- Output ----
clear
echo -e "${BOLD}Business Memorandum${RESET}"
echo -e "${BLUE}Date:${RESET} $(date +"%B %d, %Y")"
echo -e "${BLUE}Subject:${RESET} Local System Operating System Inventory"
echo -e "${BLUE}Purpose:${RESET} Network / System Documentation"
echo

printf "${BOLD}%-15s %-20s %-16s %-20s %-25s${RESET}\n" \
  "DEVICE" "HOSTNAME" "IP ADDRESS" "MAC ADDRESS" "OS VERSION"
printf "%-15s %-20s %-16s %-20s %-25s\n" \
  "---------------" "--------------------" "----------------" "--------------------" "-------------------------"

printf "%-15s %-20s %-16s %-20s %-25s\n" \
  "$IFACE" "$HOSTNAME" "${IP_ADDRESS:-N/A}" "${MAC_ADDRESS:-N/A}" "$OS_NAME $OS_VERSION"

echo
echo -e "${BOLD}Raw /etc/os-release:${RESET}"

if [ -f /etc/os-release ]; then
  echo "------------------------------"
  cat /etc/os-release
  echo "------------------------------"
else
  echo "File /etc/os-release not found."
fi

echo
echo -e "${BOLD}Note:${RESET}"
echo "All information displayed was collected directly from the local system."
