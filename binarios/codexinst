#!/usr/bin/env bash

# Function to show messages
echo_msg() {
    echo "=============================================="
    echo "$1"
    echo "=============================================="
}

echo ""
echo "_________________________________________________________"
echo ""

# Quick prerequisite check
if ! command -v npm >/dev/null 2>&1; then
  echo -e "\033[1;31m  npm is required but not found. Please install Node.js/npm and try again.  \033[0m"
  exit 1
fi

echo_msg "$(echo -e "\033[1;36m  Dev CLIs Installer  \033[0m")"

echo ""
echo "_________________________________________________________"
echo ""

echo -e "\033[1;35m  Select an option:  \033[0m"
echo -e "\033[1;33m    [1]  Install @anthropic-ai/claude-code  \033[0m"
echo -e "\033[1;32m    [2]  Install @openai/codex              \033[0m"
echo -e "\033[1;34m    [3]  Install @google/gemini-cli         \033[0m"
echo -e "\033[1;36m    [4]  Install ALL                         \033[0m"
echo -e "\033[1;31m    [5]  Exit                                \033[0m"

echo ""
read -rp "$(echo -e "\033[1;35m  Enter choice [1-5]: \033[0m")" CHOICE

echo ""
echo "_________________________________________________________"
echo ""

install_and_try() {
  PKG="$1"
  CMD="$2"
  VERFLAG="$3"

  echo_msg "$(echo -e "\033[1;36m  Installing $PKG  \033[0m")"
  echo ""
  echo -e "\033[1;33m  Running: sudo npm install -g $PKG  \033[0m"
  sudo npm install -g "$PKG"
  echo ""
  echo -e "\033[1;32m  $PKG installed.  \033[0m"

  if command -v "$CMD" >/dev/null 2>&1; then
    echo ""
    echo_msg "$(echo -e "\033[1;36m  Executing: $CMD $VERFLAG  \033[0m")"
    echo ""
    "$CMD" $VERFLAG || true
  else
    echo ""
    echo -e "\033[1;31m  Command not found after install: $CMD  \033[0m"
  fi

  echo ""
  echo "_________________________________________________________"
  echo ""
}

case "$CHOICE" in
  1)
    install_and_try "@anthropic-ai/claude-code" "claude" "-v"
    ;;
  2)
    install_and_try "@openai/codex" "codex" "--version"
    ;;
  3)
    install_and_try "@google/gemini-cli" "gemini" "--version"
    ;;
  4)
    install_and_try "@anthropic-ai/claude-code" "claude" "-v"
    install_and_try "@openai/codex" "codex" "--version"
    install_and_try "@google/gemini-cli" "gemini" "--version"
    ;;
  5)
    echo_msg "$(echo -e "\033[1;36m  Bye!  \033[0m")"
    exit 0
    ;;
  *)
    echo -e "\033[1;31m  Invalid choice.  \033[0m"
    exit 1
    ;;
esac

echo_msg "$(echo -e "\033[1;36m  Done.  \033[0m")"

echo ""
echo "_________________________________________________________"
echo ""